<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#00695C">
<title>TF Business v2.0.1</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --primary:#00695C;
  --primary-light:#009688;
  --primary-dark:#004D40;
  --accent:#FFC107;
  --accent-text:#000;
  --danger:#f53d3d;
  --pink:#E91E63;
  --orange:#FF5722;
  --green:#32db64;
  --bg:#f4f4f4;
  --bg-white:#ffffff;
  --bg-toolbar:#00695C;
  --text-dark:#222;
  --text-black:#000;
  --text-secondary:#666;
  --text-light:#999;
  --border-color:#e0e0e0;
  --border-light:#BDBDBD;
  --shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.2),0 1px 5px 0 rgba(0,0,0,0.12);
  --toolbar-h:56px;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
}
html{font-size:16px;-webkit-tap-highlight-color:transparent}
body{
  font-family:'Roboto','Noto Sans','Helvetica Neue',sans-serif;
  background:var(--bg);
  color:var(--text-dark);
  min-height:100dvh;
  overflow-x:hidden;
  font-size:1rem;
}
a{color:var(--primary-light);text-decoration:none}

/* ===== TOOLBAR ===== */
.toolbar{
  position:sticky;top:0;z-index:100;
  height:var(--toolbar-h);
  padding-top:var(--safe-top);
  background:var(--bg-toolbar);
  display:flex;align-items:center;
  padding-left:8px;padding-right:8px;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.toolbar .menu-btn{
  width:48px;height:48px;
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-size:24px;cursor:pointer;
  border:none;background:none;border-radius:50%;
}
.toolbar .menu-btn:active{background:rgba(255,255,255,0.15);transform:scale(0.95)}
.toolbar .title{
  flex:1;color:#fff;
  font-size:1.15rem;font-weight:400;
  margin-left:8px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.toolbar .toolbar-btns{display:flex;align-items:center;gap:4px}
.toolbar .toolbar-btns .t-btn{
  width:44px;height:44px;
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-size:22px;cursor:pointer;
  border:none;background:none;border-radius:50%;position:relative;
}
.toolbar .toolbar-btns .t-btn:active{background:rgba(255,255,255,0.15);transform:scale(0.95)}
.t-btn .badge-dot{
  position:absolute;top:8px;right:8px;
  width:8px;height:8px;border-radius:50%;
  background:var(--orange);
}

/* ===== SIDE MENU ===== */
.menu-overlay{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,0.4);
  display:none;opacity:0;
  transition:opacity 0.3s;
}
.menu-overlay.open{display:block;opacity:1}
.side-menu{
  position:fixed;top:0;left:-280px;bottom:0;z-index:201;
  width:280px;
  background:var(--bg-white);
  transition:left 0.3s cubic-bezier(0.4,0,0.2,1);
  box-shadow:2px 0 12px rgba(0,0,0,0.3);
  display:flex;flex-direction:column;
  overflow-y:auto;
}
.side-menu.open{left:0}
.menu-header{
  background:var(--bg-toolbar);
  padding:24px 16px 16px;
  padding-top:calc(24px + var(--safe-top));
  color:#fff;
  min-height:120px;
  display:flex;flex-direction:column;justify-content:flex-end;
}
.menu-header .menu-app-name{font-size:1.3rem;font-weight:500;margin-bottom:4px}
.menu-header .menu-user{font-size:0.85rem;opacity:0.8}
.menu-items{flex:1;padding:8px 0}
.menu-item{
  display:flex;align-items:center;gap:16px;
  padding:14px 16px;
  cursor:pointer;
  color:var(--text-dark);
  font-size:0.95rem;
  transition:background 0.15s;
  min-height:48px;
}
.menu-item:active{background:rgba(0,0,0,0.06);transform:scale(0.98)}
.menu-item.active{background:rgba(0,105,92,0.08);color:var(--primary)}
.menu-item .mi-icon{
  width:24px;height:24px;
  display:flex;align-items:center;justify-content:center;
  color:var(--text-secondary);font-size:22px;
}
.menu-item.active .mi-icon{color:var(--primary)}
.menu-divider{height:1px;background:var(--border-color);margin:8px 0}

/* ===== PAGES ===== */
.page{display:none}
.page.active{display:block;animation:pageFade 0.2s ease}
@keyframes pageFade{from{opacity:0}to{opacity:1}}

/* ===== HOME PAGE ===== */
.home-content{text-align:center;padding:0}
.home-logo{height:140px;margin:20px auto 0;display:block}
.home-desc{
  margin:20px 0 10px;
  font-size:1rem;font-weight:600;
  color:var(--primary-light);
}
.home-grid{
  display:flex;flex-wrap:wrap;
  justify-content:center;
  margin:5px 0 10px;gap:6px;
  padding:0 8px;
}
.home-card{
  width:calc(33.33% - 8px);max-width:150px;
  height:85px;
  background:#fff;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  border-radius:0;
  box-shadow:inset 0 0 1px 0 #253380;
  cursor:pointer;
  text-align:center;
  padding:8px 4px;
}
.home-card:active{transform:scale(0.95);background:#f5f5f5}
.home-card .hc-icon{font-size:28px;color:var(--primary);opacity:0.8;margin-bottom:4px}
.home-card .hc-label{font-size:0.72rem;color:var(--text-dark);line-height:1.2}
.home-values{padding:8px 16px}
.home-val-row{
  display:flex;justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid var(--border-light);
  font-size:0.95rem;
}
.home-val-row .hv-label{color:var(--text-secondary)}
.home-val-row .hv-value{font-size:1.1rem;font-weight:600}
.hv-pink{color:var(--pink)}
.hv-teal{color:var(--primary-light)}
.hv-orange{color:var(--orange);text-decoration:underline}
.hv-green{color:#4CAF50;text-decoration:underline}
.home-app{font-style:italic;font-size:0.85rem;margin:5px 10px;color:#3e4b90;text-align:center;padding-bottom:16px}

/* ===== PRODUCT / CATALOG ===== */
.segment-bar{
  display:flex;
  background:var(--primary);
}
.segment-btn{
  flex:1;
  height:44px;
  display:flex;align-items:center;justify-content:center;
  font-size:0.9rem;
  text-transform:uppercase;
  color:#fff;
  background:var(--primary);
  border:none;
  border-bottom:3px solid transparent;
  cursor:pointer;
  font-weight:500;
  font-family:inherit;
}
.segment-btn:active{transform:scale(0.95)}
.segment-btn.active{border-bottom-color:var(--pink)}

.product-list{padding:0}
.product-item{
  display:flex;
  align-items:flex-start;
  padding:10px 16px;
  border-bottom:1px solid var(--border-color);
  background:#fff;
  cursor:pointer;
  gap:16px;
  min-height:48px;
}
.product-item:active{background:#f0f0f0;transform:scale(0.98)}
.product-thumb{
  width:120px;height:100px;
  border-radius:10px;
  overflow:hidden;
  flex-shrink:0;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
}
.product-thumb img{width:100%;height:100%;object-fit:cover}
.product-thumb .thumb-placeholder{font-size:2rem;color:var(--border-light)}
.product-info{
  flex:1;
  display:flex;flex-direction:column;
  justify-content:center;
  min-height:100px;
}
.product-info .pi-name{
  font-size:1rem;font-weight:600;
  color:var(--primary-light);
  margin-bottom:4px;
}
.product-info .pi-category{
  font-size:0.8rem;
  color:var(--text-secondary);
  margin-bottom:8px;
}
.product-info .pi-price-row{
  display:flex;align-items:center;gap:12px;
}
.pi-price{
  display:inline-block;
  background:var(--orange);
  color:#fff;
  padding:2px 10px;
  border-radius:2px;
  font-size:0.85rem;font-weight:500;
}
.pi-lp{
  font-size:0.85rem;font-weight:600;
  color:var(--primary-light);
}

/* ===== PRODUCT DETAIL ===== */
.detail-overlay{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,0.5);
  display:none;align-items:flex-end;justify-content:center;
}
.detail-overlay.open{display:flex}
.detail-sheet{
  background:#fff;
  border-radius:16px 16px 0 0;
  width:100%;max-width:540px;
  max-height:90dvh;
  overflow-y:auto;
  animation:sheetUp 0.3s ease;
  padding-bottom:var(--safe-bottom);
}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.detail-handle{
  display:flex;justify-content:center;
  padding:12px 0 4px;
  cursor:pointer;
}
.detail-handle div{width:40px;height:4px;background:var(--border-light);border-radius:4px}
.detail-img-wrap{
  width:100%;aspect-ratio:4/3;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}
.detail-img-wrap img{width:100%;height:100%;object-fit:contain}
.detail-body{padding:16px}
.detail-body .db-category{font-size:0.8rem;color:var(--primary-light);font-weight:600;margin-bottom:4px}
.detail-body .db-name{font-size:1.25rem;font-weight:700;color:var(--text-dark);margin-bottom:12px}
.detail-body .db-meta{
  display:flex;gap:12px;margin-bottom:16px;
  padding:12px;background:var(--bg);border-radius:8px;
}
.db-meta-item{text-align:center;flex:1}
.db-meta-item .dm-label{font-size:0.7rem;color:var(--text-light);margin-bottom:2px}
.db-meta-item .dm-value{font-size:1.05rem;font-weight:700}
.dm-value.price-c{color:var(--orange)}
.dm-value.lp-c{color:var(--primary-light)}
.detail-body .db-desc{
  font-size:0.9rem;color:var(--text-dark);
  line-height:1.6;
}
.db-desc b,.db-desc strong{color:var(--text-black)}
.db-desc ul{padding-left:20px;margin:8px 0}
.db-desc li{margin-bottom:6px}
.db-desc font[color]{color:var(--primary-light) !important}
.detail-body .db-cart-btn{
  display:block;width:100%;
  margin-top:16px;padding:14px;
  background:var(--accent);color:var(--accent-text);
  border:none;border-radius:4px;
  font-size:1rem;font-weight:500;
  text-transform:uppercase;
  cursor:pointer;
  box-shadow:var(--shadow);
  min-height:48px;
  font-family:inherit;
}
.db-cart-btn:active{transform:scale(0.95);filter:brightness(0.95)}

/* ===== NOTIFICATIONS ===== */
.notif-list{padding:0}
.notif-section{
  padding:8px 16px 4px;
  font-size:0.75rem;
  color:var(--text-light);
  text-transform:uppercase;
  letter-spacing:0.05em;
  background:var(--bg);
}
.notif-item{
  display:flex;gap:12px;
  padding:14px 16px;
  background:#fff;
  border-bottom:1px solid var(--border-color);
  min-height:48px;
  cursor:pointer;
}
.notif-item:active{background:#f5f5f5;transform:scale(0.98)}
.notif-item.is-new{border-left:3px solid var(--primary-light)}
.ni-icon{
  width:40px;height:40px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;flex-shrink:0;
}
.ni-icon.ni-money{background:#E8F5E9;color:#2E7D32}
.ni-icon.ni-news{background:#E0F2F1;color:var(--primary)}
.ni-icon.ni-system{background:#FFF3E0;color:#E65100}
.ni-icon.ni-other{background:var(--bg);color:var(--text-secondary)}
.ni-body{flex:1;min-width:0}
.ni-text{font-size:0.9rem;line-height:1.4;color:var(--text-dark);margin-bottom:2px}
.ni-type{font-size:0.75rem;color:var(--text-light)}

/* ===== NEWS (placeholder) ===== */
.placeholder-page{
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  padding:60px 24px;text-align:center;
}
.placeholder-page .pp-icon{font-size:48px;color:var(--border-light);margin-bottom:16px}
.placeholder-page .pp-title{font-size:1.05rem;font-weight:500;color:var(--text-dark);margin-bottom:8px}
.placeholder-page .pp-text{font-size:0.85rem;color:var(--text-secondary);line-height:1.5}

/* ===== SETTINGS ===== */
.settings-list{padding:0}
.settings-group-title{
  padding:16px 16px 8px;
  font-size:0.8rem;font-weight:600;
  color:var(--primary-light);
}
.settings-item{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;
  background:#fff;
  border-bottom:1px solid var(--border-color);
  font-size:0.95rem;
  min-height:48px;
}
.settings-item .si-label{color:var(--text-dark)}
.settings-item .si-value{color:var(--text-secondary);font-size:0.85rem}

/* ===== LOADING / ERROR ===== */
.loading{display:flex;flex-direction:column;align-items:center;padding:48px 20px;gap:12px}
.spinner{
  width:28px;height:28px;
  border:3px solid var(--border-color);
  border-top-color:var(--primary-light);
  border-radius:50%;
  animation:spin 0.7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text-light);font-size:0.85rem}
.error-block{
  margin:16px;padding:16px;
  background:#FFEBEE;border:1px solid #FFCDD2;
  border-radius:4px;color:var(--danger);
  font-size:0.85rem;text-align:center;
}
.error-block .retry-btn{
  display:inline-block;margin-top:10px;
  padding:8px 24px;min-height:44px;
  background:var(--accent);color:var(--accent-text);
  border:none;border-radius:4px;
  font-size:0.85rem;font-weight:500;
  cursor:pointer;text-transform:uppercase;
  box-shadow:var(--shadow);
}
.retry-btn:active{transform:scale(0.95)}

/* ===== CONFIG BANNER ===== */
.config-banner{
  margin:12px;padding:16px;
  background:#E0F2F1;
  border:1px solid #B2DFDB;
  border-radius:4px;
}
.config-banner strong{color:var(--primary)}
.config-banner p{font-size:0.85rem;color:var(--text-dark);margin-bottom:8px;line-height:1.4}
.config-banner input{
  width:100%;padding:10px 12px;
  border:1px solid var(--border-color);
  border-radius:4px;font-size:0.85rem;
  font-family:monospace;
  margin-bottom:8px;
}
.config-banner input:focus{border-color:var(--primary);outline:none}
.config-banner button{
  padding:10px 24px;min-height:44px;
  background:var(--accent);color:var(--accent-text);
  border:none;border-radius:4px;
  font-size:0.85rem;font-weight:500;
  text-transform:uppercase;cursor:pointer;
  box-shadow:var(--shadow);
}
.config-banner button:active{transform:scale(0.95)}

/* ===== STATUS DOT ===== */
.status-indicator{
  display:flex;align-items:center;gap:6px;
  padding:0 12px;
}
.s-dot{
  width:8px;height:8px;border-radius:50%;
}
.s-dot.online{background:var(--green);box-shadow:0 0 6px rgba(50,219,100,0.5)}
.s-dot.offline{background:var(--danger);box-shadow:0 0 6px rgba(245,61,61,0.5)}
.s-dot.loading{background:var(--accent);animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
</style>
</head>
<body>

<!-- TOOLBAR -->
<header class="toolbar" id="toolbar">
  <button class="menu-btn" onclick="toggleMenu()" aria-label="–ú–µ–Ω—é">
    <span class="material-icons">menu</span>
  </button>
  <div class="title" id="toolbarTitle">–ì–ª–∞–≤–Ω–∞—è</div>
  <div class="toolbar-btns">
    <div class="status-indicator"><div class="s-dot loading" id="statusDot"></div></div>
    <button class="t-btn" onclick="switchPage('notifications')" aria-label="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
      <span class="material-icons">notifications</span>
      <div class="badge-dot" id="notifDot" style="display:none"></div>
    </button>
  </div>
</header>

<!-- SIDE MENU -->
<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
<nav class="side-menu" id="sideMenu">
  <div class="menu-header">
    <div class="menu-app-name">–ú–∏—Ä TF</div>
    <div class="menu-user" id="menuUser">–î–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä</div>
  </div>
  <div class="menu-items">
    <div class="menu-item active" onclick="switchPage('home')">
      <span class="mi-icon material-icons">home</span> –ì–ª–∞–≤–Ω–∞—è
    </div>
    <div class="menu-item" onclick="switchPage('catalog')">
      <span class="mi-icon material-icons">apps</span> –ö–∞—Ç–∞–ª–æ–≥
    </div>
    <div class="menu-item" onclick="switchPage('orders')">
      <span class="mi-icon material-icons">check_circle</span> –î–æ–∫—É–º–µ–Ω—Ç—ã
    </div>
    <div class="menu-item" onclick="switchPage('buyers')">
      <span class="mi-icon material-icons">people</span> –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏
    </div>
    <div class="menu-item" onclick="switchPage('news')">
      <span class="mi-icon material-icons">format_align_justify</span> –ù–æ–≤–æ—Å—Ç–∏
    </div>
    <div class="menu-item" onclick="switchPage('notifications')">
      <span class="mi-icon material-icons">notifications</span> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    </div>
    <div class="menu-item" onclick="switchPage('articles')">
      <span class="mi-icon material-icons">local_library</span> –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    </div>
    <div class="menu-item" onclick="switchPage('faq')">
      <span class="mi-icon material-icons">help</span> –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
    </div>
    <div class="menu-divider"></div>
    <div class="menu-item" onclick="switchPage('settings')">
      <span class="mi-icon material-icons">settings</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    </div>
  </div>
</nav>

<!-- CONFIG BANNER -->
<div class="config-banner" id="configBanner" style="display:none">
  <p><strong>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API</strong><br>–í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ Cloudflare Worker:</p>
  <input type="text" id="workerUrlInput" placeholder="https://tf-api.–≤–∞—à-–∞–∫–∫–∞—É–Ω—Ç.workers.dev">
  <button onclick="saveWorkerUrl()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<!-- PAGE: HOME -->
<div class="page active" id="pageHome">
  <div class="home-content">
    <img class="home-logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 140'%3E%3Crect fill='%23E0F2F1' width='200' height='140' rx='8'/%3E%3Ctext x='100' y='60' text-anchor='middle' font-family='sans-serif' font-size='18' font-weight='bold' fill='%2300695C'%3E4Life%3C/text%3E%3Ctext x='100' y='85' text-anchor='middle' font-family='sans-serif' font-size='12' fill='%23009688'%3ETransfer Factor%3C/text%3E%3Ctext x='100' y='110' text-anchor='middle' font-family='sans-serif' font-size='24'%3Eüíé%3C/text%3E%3C/svg%3E" alt="TF">
    <div class="home-desc">TF Business</div>
    <div class="home-grid" id="homeGrid">
      <div class="home-card" onclick="switchPage('catalog')">
        <span class="hc-icon material-icons">shopping_cart</span>
        <span class="hc-label">–ö–∞—Ç–∞–ª–æ–≥</span>
      </div>
      <div class="home-card" onclick="switchPage('orders')">
        <span class="hc-icon material-icons">receipt</span>
        <span class="hc-label">–î–æ–∫—É–º–µ–Ω—Ç—ã</span>
      </div>
      <div class="home-card" onclick="switchPage('notifications')">
        <span class="hc-icon material-icons">notifications</span>
        <span class="hc-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
      </div>
      <div class="home-card" onclick="switchPage('news')">
        <span class="hc-icon material-icons">article</span>
        <span class="hc-label">–ù–æ–≤–æ—Å—Ç–∏</span>
      </div>
      <div class="home-card" onclick="switchPage('buyers')">
        <span class="hc-icon material-icons">group</span>
        <span class="hc-label">–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏</span>
      </div>
      <div class="home-card" onclick="switchPage('settings')">
        <span class="hc-icon material-icons">settings</span>
        <span class="hc-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </div>
    </div>
    <div class="home-values" id="homeValues">
      <div class="home-val-row"><span class="hv-label">–ë–∞–ª–∞–Ω—Å –õ–°</span><span class="hv-value hv-pink">‚Äî</span></div>
      <div class="home-val-row"><span class="hv-label">LP –±–∞–ª–ª—ã</span><span class="hv-value hv-teal">‚Äî</span></div>
      <div class="home-val-row"><span class="hv-label">–ó–∞–∫–∞–∑–æ–≤</span><span class="hv-value hv-orange">‚Äî</span></div>
      <div class="home-val-row"><span class="hv-label">–ü–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</span><span class="hv-value hv-green">‚Äî</span></div>
    </div>
    <div class="home-app">–ú–∏—Ä TF ‚Äî –í–µ—Ä—Å–∏—è 2.0.1</div>
  </div>
</div>

<!-- PAGE: CATALOG -->
<div class="page" id="pageCatalog">
  <div class="segment-bar" id="segmentBar"></div>
  <div id="catalogContent">
    <div class="loading"><div class="spinner"></div><div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...</div></div>
  </div>
</div>

<!-- PAGE: NOTIFICATIONS -->
<div class="page" id="pageNotifications">
  <div id="notifContent">
    <div class="loading"><div class="spinner"></div><div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...</div></div>
  </div>
</div>

<!-- PAGE: ORDERS -->
<div class="page" id="pageOrders">
  <div class="placeholder-page">
    <span class="pp-icon material-icons">receipt_long</span>
    <div class="pp-title">–î–æ–∫—É–º–µ–Ω—Ç—ã</div>
    <div class="pp-text">–†–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è<br>endpoint'–∞ –∑–∞–∫–∞–∑–æ–≤ –≤ API 1–°</div>
  </div>
</div>

<!-- PAGE: BUYERS -->
<div class="page" id="pageBuyers">
  <div class="placeholder-page">
    <span class="pp-icon material-icons">people</span>
    <div class="pp-title">–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏</div>
    <div class="pp-text">–†–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è<br>endpoint'–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ API 1–°</div>
  </div>
</div>

<!-- PAGE: NEWS -->
<div class="page" id="pageNews">
  <div class="placeholder-page">
    <span class="pp-icon material-icons">article</span>
    <div class="pp-title">–ù–æ–≤–æ—Å—Ç–∏</div>
    <div class="pp-text">–†–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏<br>–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ endpoint'–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ API 1–°</div>
  </div>
</div>

<!-- PAGE: ARTICLES -->
<div class="page" id="pageArticles">
  <div class="placeholder-page">
    <span class="pp-icon material-icons">local_library</span>
    <div class="pp-title">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</div>
    <div class="pp-text">–°—Ç–∞—Ç—å–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è<br>–±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–∑–∂–µ</div>
  </div>
</div>

<!-- PAGE: FAQ -->
<div class="page" id="pageFaq">
  <div class="placeholder-page">
    <span class="pp-icon material-icons">help_center</span>
    <div class="pp-title">–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</div>
    <div class="pp-text">FAQ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω<br>–ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</div>
  </div>
</div>

<!-- PAGE: SETTINGS -->
<div class="page" id="pageSettings">
  <div class="settings-list">
    <div class="settings-group-title">–û–±—â–∏–µ</div>
    <div class="settings-item"><span class="si-label">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</span><span class="si-value">–†—É—Å—Å–∫–∏–π</span></div>
    <div class="settings-item"><span class="si-label">–í–µ—Ä—Å–∏—è</span><span class="si-value">2.0.1</span></div>
    <div class="settings-group-title">API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div>
    <div class="settings-item"><span class="si-label">–°—Ç–∞—Ç—É—Å</span><span class="si-value" id="settingsStatus">‚Äî</span></div>
    <div class="settings-item"><span class="si-label">Worker URL</span><span class="si-value" id="settingsWorker" style="word-break:break-all;max-width:60%">‚Äî</span></div>
    <div class="settings-item"><span class="si-label">–¢–æ–≤–∞—Ä–æ–≤</span><span class="si-value" id="settingsProducts">‚Äî</span></div>
    <div class="settings-item"><span class="si-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span><span class="si-value" id="settingsNotifs">‚Äî</span></div>
    <div class="settings-group-title">–°–∏—Å—Ç–µ–º–∞</div>
    <div class="settings-item"><span class="si-label">–§—Ä–æ–Ω—Ç–µ–Ω–¥</span><span class="si-value">GitHub Pages</span></div>
    <div class="settings-item"><span class="si-label">–ü—Ä–æ–∫—Å–∏</span><span class="si-value">Cloudflare Worker</span></div>
    <div class="settings-item"><span class="si-label">–ë—ç–∫–µ–Ω–¥</span><span class="si-value">1–° HTTP-—Å–µ—Ä–≤–∏—Å</span></div>
    <div class="settings-item" style="cursor:pointer" onclick="resetConfig()"><span class="si-label" style="color:var(--danger)">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API</span><span class="si-value"></span></div>
  </div>
</div>

<!-- PRODUCT DETAIL -->
<div class="detail-overlay" id="detailOverlay" onclick="if(event.target===this)closeDetail()">
  <div class="detail-sheet">
    <div class="detail-handle" onclick="closeDetail()"><div></div></div>
    <div class="detail-img-wrap" id="detailImg"></div>
    <div class="detail-body">
      <div class="db-category" id="detailCat"></div>
      <div class="db-name" id="detailName"></div>
      <div class="db-meta">
        <div class="db-meta-item"><div class="dm-label">–¶–µ–Ω–∞</div><div class="dm-value price-c" id="detailPrice"></div></div>
        <div class="db-meta-item"><div class="dm-label">LP –±–∞–ª–ª—ã</div><div class="dm-value lp-c" id="detailLP"></div></div>
      </div>
      <div class="db-desc" id="detailDesc"></div>
      <button class="db-cart-btn" onclick="closeDetail()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>
</div>

<script>
const USER_ID="000000004";
const STORAGE_KEY="tf_worker_url";
let WORKER_URL=localStorage.getItem(STORAGE_KEY)||"https://tf-api.camenadoo.workers.dev";
let productsData=[];
let notifsData={new:[],old:[]};
let categories=[];
const titles={home:"–ì–ª–∞–≤–Ω–∞—è",catalog:"–ö–∞—Ç–∞–ª–æ–≥",orders:"–î–æ–∫—É–º–µ–Ω—Ç—ã",buyers:"–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏",news:"–ù–æ–≤–æ—Å—Ç–∏",notifications:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",articles:"–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π",faq:"–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã",settings:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"};

document.addEventListener("DOMContentLoaded",()=>{
  loadAll();
});

function saveWorkerUrl(){
  let u=document.getElementById("workerUrlInput").value.trim();
  if(!u)return;
  if(!u.startsWith("http"))u="https://"+u;
  u=u.replace(/\/+$/,"");
  WORKER_URL=u;
  localStorage.setItem(STORAGE_KEY,u);
  document.getElementById("configBanner").style.display="none";
  loadAll();
}
function resetConfig(){
  if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API?")){
    localStorage.removeItem(STORAGE_KEY);
    WORKER_URL="";
    location.reload();
  }
}

// === MENU ===
function toggleMenu(){
  document.getElementById("sideMenu").classList.toggle("open");
  document.getElementById("menuOverlay").classList.toggle("open");
}
function switchPage(name){
  document.getElementById("sideMenu").classList.remove("open");
  document.getElementById("menuOverlay").classList.remove("open");
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  const pageId="page"+name.charAt(0).toUpperCase()+name.slice(1);
  const el=document.getElementById(pageId);
  if(el)el.classList.add("active");
  document.getElementById("toolbarTitle").textContent=titles[name]||name;
  document.querySelectorAll(".menu-item").forEach(m=>m.classList.remove("active"));
  const items=document.querySelectorAll(".menu-item");
  items.forEach(m=>{if(m.textContent.trim()===titles[name])m.classList.add("active")});
}

// === API ===
async function apiCall(ep){
  if(!WORKER_URL)throw new Error("Worker URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω");
  const r=await fetch(WORKER_URL+ep);
  if(!r.ok)throw new Error("HTTP "+r.status);
  return await r.json();
}
async function loadAll(){
  if(!WORKER_URL){setStatus("offline");return}
  setStatus("loading");
  await Promise.all([loadProducts(),loadNotifications()]);
}

// === PRODUCTS ===
async function loadProducts(){
  const el=document.getElementById("catalogContent");
  try{
    const d=await apiCall("/products/getList?userId="+USER_ID);
    if(d.isError)throw new Error(d.error||"–û—à–∏–±–∫–∞");
    productsData=d.products||[];
    const catMap=new Map();
    productsData.forEach(p=>{if(p.categoryName&&!catMap.has(p.categoryId))catMap.set(p.categoryId,p.categoryName)});
    categories=Array.from(catMap,([id,name])=>({id,name}));
    renderSegments();
    renderProducts(productsData);
    setStatus("online");
    document.getElementById("settingsProducts").textContent=productsData.length;
    document.getElementById("settingsStatus").textContent="‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ";
    document.getElementById("settingsWorker").textContent=WORKER_URL;
  }catch(e){
    el.innerHTML='<div class="error-block">–û—à–∏–±–∫–∞: '+esc(e.message)+'<br><button class="retry-btn" onclick="loadProducts()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button></div>';
    setStatus("offline");
    document.getElementById("settingsStatus").textContent="‚ùå "+e.message;
  }
}
function renderSegments(){
  const bar=document.getElementById("segmentBar");
  if(categories.length<=1){bar.innerHTML="";return}
  let h='<button class="segment-btn active" onclick="filterCat(null,this)">–í—Å–µ</button>';
  categories.forEach(c=>{h+='<button class="segment-btn" onclick="filterCat(\''+c.id+'\',this)">'+esc(c.name)+"</button>"});
  bar.innerHTML=h;
}
function filterCat(id,btn){
  document.querySelectorAll(".segment-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  renderProducts(id?productsData.filter(p=>p.categoryId===id):productsData);
}
function renderProducts(list){
  const el=document.getElementById("catalogContent");
  if(!list.length){el.innerHTML='<div class="placeholder-page"><span class="pp-icon material-icons">inventory_2</span><div class="pp-title">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div></div>';return}
  let h='<div class="product-list">';
  list.forEach((p,i)=>{
    const img=p.image?'<img src="data:image/jpeg;base64,'+p.image+'" alt="'+esc(p.productName)+'" loading="lazy">':'<span class="thumb-placeholder material-icons">image</span>';
    h+='<div class="product-item" onclick="openDetail('+i+')">'
      +'<div class="product-thumb">'+img+'</div>'
      +'<div class="product-info">'
      +'<div class="pi-name">'+esc(p.productName)+'</div>'
      +'<div class="pi-category">'+esc(p.categoryName||"")+'</div>'
      +'<div class="pi-price-row">'
      +'<span class="pi-price">'+fmtPrice(p.price)+' ‚ÇΩ</span>'
      +(p.LP?'<span class="pi-lp">'+p.LP+' LP</span>':'')
      +'</div></div></div>';
  });
  h+='</div>';
  el.innerHTML=h;
}

// === DETAIL ===
function openDetail(i){
  const p=productsData[i];if(!p)return;
  document.getElementById("detailImg").innerHTML=p.image?'<img src="data:image/jpeg;base64,'+p.image+'">':'<span class="thumb-placeholder material-icons" style="font-size:64px;color:#bbb">image</span>';
  document.getElementById("detailCat").textContent=p.categoryName||"";
  document.getElementById("detailName").textContent=p.productName;
  document.getElementById("detailPrice").textContent=fmtPrice(p.price)+" ‚ÇΩ";
  document.getElementById("detailLP").textContent=(p.LP||0)+" LP";
  document.getElementById("detailDesc").innerHTML=p.description?cleanHtml(p.description):"–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç";
  document.getElementById("detailOverlay").classList.add("open");
  document.body.style.overflow="hidden";
}
function closeDetail(){
  document.getElementById("detailOverlay").classList.remove("open");
  document.body.style.overflow="";
}

// === NOTIFICATIONS ===
async function loadNotifications(){
  const el=document.getElementById("notifContent");
  try{
    const d=await apiCall("/notifications/getList?userId="+USER_ID);
    if(d.isError)throw new Error(d.error||"–û—à–∏–±–∫–∞");
    notifsData=d.notifications||{new:[],old:[]};
    const nc=(notifsData.new||[]).length;
    const total=nc+(notifsData.old||[]).length;
    document.getElementById("notifDot").style.display=nc>0?"block":"none";
    document.getElementById("settingsNotifs").textContent=total;
    renderNotifs();
  }catch(e){
    el.innerHTML='<div class="error-block">–û—à–∏–±–∫–∞: '+esc(e.message)+'<br><button class="retry-btn" onclick="loadNotifications()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button></div>';
  }
}
function renderNotifs(){
  const el=document.getElementById("notifContent");
  const nw=notifsData.new||[],ol=notifsData.old||[];
  if(!nw.length&&!ol.length){el.innerHTML='<div class="placeholder-page"><span class="pp-icon material-icons">notifications_none</span><div class="pp-title">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div></div>';return}
  let h='<div class="notif-list">';
  if(nw.length){h+='<div class="notif-section">–ù–æ–≤—ã–µ ('+nw.length+')</div>';nw.forEach(n=>{h+=notifHtml(n,true)})}
  if(ol.length){h+='<div class="notif-section">–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</div>';ol.forEach(n=>{h+=notifHtml(n,false)})}
  h+='</div>';el.innerHTML=h;
}
function notifHtml(n,isNew){
  const t=n.type||"";
  let ic="mail",cls="ni-other";
  if(t.includes("–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ")||t.includes("–î–°")){ic="payments";cls="ni-money"}
  else if(t.includes("–ù–æ–≤–æ—Å—Ç—å")||t.includes("–ù–æ–≤–æ—Å")){ic="article";cls="ni-news"}
  else if(t.includes("–°–∏—Å—Ç–µ–º")){ic="settings";cls="ni-system"}
  return '<div class="notif-item'+(isNew?" is-new":"")+'">'
    +'<div class="ni-icon '+cls+'"><span class="material-icons">'+ic+'</span></div>'
    +'<div class="ni-body"><div class="ni-text">'+esc(n.name||"")+'</div><div class="ni-type">'+esc(t)+'</div></div></div>';
}

// === HELPERS ===
function setStatus(s){
  const d=document.getElementById("statusDot");
  d.className="s-dot "+s;
}
function fmtPrice(p){const n=parseFloat(p);return isNaN(n)?p:n.toLocaleString("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0})}
function esc(s){if(!s)return"";const d=document.createElement("div");d.textContent=s;return d.innerHTML}
function cleanHtml(h){return h.replace(/<o:p><\/o:p>/gi,"").replace(/<p class="MsoNormal">/gi,"<p>").replace(/style="[^"]*caret-color[^"]*"/gi,"")}
document.addEventListener("keydown",e=>{if(e.key==="Escape"){closeDetail();document.getElementById("sideMenu").classList.remove("open");document.getElementById("menuOverlay").classList.remove("open")}});
</script>
</body>
</html>
